package router

import (

    "backend-task/internal/handlers"
    "backend-task/internal/repository"
    "backend-task/internal/services"
    "github.com/gin-gonic/gin"
    "gorm.io/gorm"
)

func SetupRouter(db *gorm.DB) *gin.Engine {

    repo := repository.NewUserRepository(db)
    service := services.NewUserService(repo, db)
    handler := handlers.NewUserHandler(service)

    r := gin.Default()

    r.POST("/users", handler.CreateUserHandler)
    r.GET("/users/:id", handler.GetUser)
    r.PATCH("/users/:id", handler.UpdateUser)
    r.GET("/users", func(c *gin.Context) {
        group := c.Query("group")
        if group != "" {
            handler.GetUsersByGroup(c)
        } else {
            handler.GetAllUsers(c)
        }
    })

    return r
}
